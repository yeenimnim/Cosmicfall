<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>주판룬키</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #f0f0f0;
      font-family: sans-serif;
      transition: background-color 0.3s, color 0.3s;
    }

    body.dark-mode {
      background-color: #121212;
      color: #ffffff;
    }

    h1 {
      margin: 20px 0 10px;
    }

    .buttons {
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .row-wrapper {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .row-buttons {
      display: flex;
      flex-direction: column;
      gap: 5px;
      margin-left: 10px;
    }

    .abacus-row {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
    }

    .bead {
      width: 80px;
      height: 80px;
      background-image: url('floor_cave.png');
      background-size: cover;
      background-position: center;
      margin: 2px;
      cursor: pointer;
      transition: transform 0.3s, opacity 0.3s;
      position: relative;
    }

    .moved {
      transform: translateY(+90px);
    }

    .blurred {
      opacity: 0.4;
    }

    .number {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 16px;
      color: #fff;
      background-color: rgba(0, 0, 0, 0.6);
      border-radius: 50%;
      width: 25px;
      height: 25px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
  </style>
</head>
<body>
  <h1>주판룬키</h1>

  <!-- 상단 컨트롤 버튼들 -->
  <div class="buttons">
    <button id="resetAllButton">전체 초기화</button>
    <button id="reverseAllButton">전체 숫자 역순</button>
    <button id="darkModeButton">다크모드</button>
    <button id="addRowButton">1줄 추가</button>
  </div>

  <!-- 전체 주판 줄을 담을 컨테이너 -->
  <div id="abacusContainer"></div>

  <script>
    let totalCount = 0;
    let globalReversed = false;

    const abacusContainer = document.getElementById('abacusContainer');
    const darkModeButton = document.getElementById('darkModeButton');
    const addRowButton = document.getElementById('addRowButton');
    const resetAllButton = document.getElementById('resetAllButton');
    const reverseAllButton = document.getElementById('reverseAllButton');

    // 비즈 생성
    function createBead(number) {
      const bead = document.createElement('div');
      bead.classList.add('bead');

      const numberDiv = document.createElement('div');
      numberDiv.classList.add('number');
      numberDiv.textContent = number;
      bead.appendChild(numberDiv);

      bead.addEventListener('click', () => {
        bead.classList.toggle('moved');
        bead.classList.toggle('blurred');
      });

      return bead;
    }

    // 줄 생성 함수 (기본: 10개)
    function addRow() {
      const rowWrapper = document.createElement('div');
      rowWrapper.classList.add('row-wrapper');

      const row = document.createElement('div');
      row.classList.add('abacus-row');

      let rowReversed = globalReversed;

      for (let i = 0; i < 10; i++) {
        const number = rowReversed ? totalCount + 10 - i : totalCount + i + 1;
        const bead = createBead(number);
        row.appendChild(bead);
      }

      totalCount += 10;

      // 줄별 버튼
      const rowButtons = document.createElement('div');
      rowButtons.classList.add('row-buttons');

      const resetBtn = document.createElement('button');
      resetBtn.textContent = "초기화";
      resetBtn.addEventListener('click', () => {
        const beads = row.querySelectorAll('.bead');
        beads.forEach(bead => bead.classList.remove('moved', 'blurred'));
      });

      const reverseBtn = document.createElement('button');
      reverseBtn.textContent = "숫자 역순";
      reverseBtn.addEventListener('click', () => {
        const beads = row.querySelectorAll('.bead .number');
        const current = Array.from(beads).map(b => parseInt(b.textContent));
        const reversed = [...current].reverse();
        beads.forEach((el, i) => el.textContent = reversed[i]);
      });

      rowButtons.appendChild(resetBtn);
      rowButtons.appendChild(reverseBtn);

      rowWrapper.appendChild(row);
      rowWrapper.appendChild(rowButtons);
      abacusContainer.appendChild(rowWrapper);
    }

    // 첫 줄 추가
    addRow();

    // 전체 초기화
    resetAllButton.addEventListener('click', () => {
      const allBeads = document.querySelectorAll('.bead');
      allBeads.forEach(bead => bead.classList.remove('moved', 'blurred'));
    });

    // 전체 역순
    reverseAllButton.addEventListener('click', () => {
      globalReversed = !globalReversed;
      const allNumbers = document.querySelectorAll('.bead .number');
      const current = Array.from(allNumbers).map(b => parseInt(b.textContent));
      const reversed = [...current].reverse();
      allNumbers.forEach((el, i) => el.textContent = reversed[i]);
    });

    // 다크모드 토글
    darkModeButton.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
    });

    // 줄 추가 버튼
    addRowButton.addEventListener('click', () => {
      addRow();
    });
  </script>
</body>
</html>
